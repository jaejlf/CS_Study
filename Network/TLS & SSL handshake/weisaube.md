# TLS & SSL Handshake

# A. TLS & SSL Handshakeλ€?

> TLS μ•”νΈν™”λ¥Ό μ‚¬μ©ν•λ” ν†µμ‹  μ„Έμ…μ„ μ‹¤ν–‰ν•λ” ν”„λ΅μ„Έμ¤. SSL λλ” TLS ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ ν†µμ‹ ν•λ” λΉ„λ°€ ν‚¤λ¥Ό μ„¤μ •ν•  μ μλ‹¤.

<br/>

ν†µμ‹  μ–‘μΈ΅μ€ TLS ν•Έλ“μ…°μ΄ν¬ μ¤‘μ— λ©”μ‹μ§€λ¥Ό κµν™ν•μ—¬ 1)μ„λ΅λ¥Ό μΈμ‹ν•κ³ , 2)μ„λ΅λ¥Ό κ²€μ¦ν•λ©°, 3)μ‚¬μ©ν•  μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ κµ¬μ„±ν•κ³ , 4)μ„Έμ… ν‚¤λ¥Ό ν•©μν•λ‹¤.

SSLμ€ μ¤λ μ „μ— TLS(Transport Layer Security)λ΅ λ€μ²΄λκΈ°μ—, SSL ν•Έλ“μ…°μ΄ν¬λ€ μ΄λ¦„μ΄ μ•„μ§ λ„λ¦¬ μ‚¬μ©λκ³  μμ§€λ§, μ΄μ λ” TLS ν•Έλ“μ…°μ΄ν¬λ΅ λ¶λ¦°λ‹¤.

<br/>

## 1. μ©μ–΄ μ •λ¦¬ π‘‰Β SSL, TLS

<br/>

### π“Β SSL(Secure Sockets Layer, λ³΄μ• μ†μΌ“ λ μ΄μ–΄)

> μ„λ²„ λ° λΈλΌμ°μ €μ ν‘μ¤€ μΈν„°λ„· ν”„λ΅ν† μ½λ΅, μ•”νΈν™”λ μ—°κ²°μ„ μƒμ„±ν•λ‹¤

μΈν„°λ„· ν†µμ‹ μ κ°μΈμ •λ³΄ λ³΄νΈ, μΈμ¦, λ°μ΄ν„° λ¬΄κ²°μ„±μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ Netscapeκ°€ 1995λ…„ μ²μμΌλ΅ κ°λ°ν•μ€λ‹¤. SSLμ€ ν„μ¬ μ‚¬μ© μ¤‘μΈΒ TLS μ•”νΈν™”μ μ „μ‹ μ΄λ‹¤.

<br/>

### π“Β TLS(Transport Layer \***\*Security\*\***, μ „μ†΅ κ³„μΈµ λ³΄μ•)

> μΈν„°λ„· μ»¤λ®¤λ‹μΌ€μ΄μ…μ„ μ„ν• κ°μΈ μ •λ³΄μ™€ λ°μ΄ν„° λ¬΄κ²°μ„±μ„ μ κ³µν•λ” λ³΄μ• ν”„λ΅ν† μ½

μ›Ή μ‚¬μ΄νΈλ¥Ό λ΅λ“ν•λ” μ›Ή λΈλΌμ°μ €μ™€ κ°™μ΄ μ›Ή μ‘μ© ν”„λ΅κ·Έλ¨κ³Ό μ„λ²„ κ°„μ μ»¤λ®¤λ‹μΌ€μ΄μ…μ„ **μ•”νΈν™”**ν•λ‹¤.

TLSλ” λν• μ΄λ©”μΌ, λ©”μ‹μ§€, λ³΄μ΄μ¤μ¤λ²„ IP(VoIP)μ™€ κ°™μ€ λ‹¤λ¥Έ μ»¤λ®¤λ‹μΌ€μ΄μ…μ„ μ•”νΈν™”ν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤.

Netscapeκ°€ κ°λ°ν• SSL(Secure Socket Layer)μ— κΈ°λ°ν• κΈ°μ μ΄λ‹¤.

<br/>

#### **SSL/TLS ν”„λ΅ν† μ½μ μ—­ν• **

β”οΈΒ μ•”νΈν™”, μΈμ¦, λ¬΄κ²°μ„±

- μ•”νΈν™”: μ  3μλ΅λ¶€ν„° μ „μ†΅λλ” λ°μ΄ν„°λ¥Ό μ¨κΈ΄λ‹¤
- μΈμ¦: μ •λ³΄λ¥Ό κµν™ν•λ” λ‹Ήμ‚¬μκ°€ μ”μ²­λ λ‹Ήμ‚¬μμΈμ§€ ν™•μΈ
- λ¬΄κ²°μ„±: λ°μ΄ν„°κ°€ μ„μ΅°λκ±°λ‚ λ³€μ΅°λμ§€ μ•μ•λ”μ§€ ν™•μΈ

<br/>

+) TLSμ™€ HTTPSμ μ°¨μ΄

HTTPSλ”Β HTTP ν”„λ΅ν† μ½ μƒμ„μ—μ„ TLS μ•”νΈν™”λ¥Ό κµ¬ν„ν• κ²ƒμΌλ΅ λ¨λ“  μ›Ή μ‚¬μ΄νΈμ™€ λ‹¤λ¥Έ μ›Ή μ„λΉ„μ¤μ—μ„ μ‚¬μ©λλ‹¤.

<br/>

## 2. μ©μ–΄ μ •λ¦¬(λ³µμµ) π‘‰Β λ€μΉ­ν‚¤ μ•”νΈν™”, κ³µκ°ν‚¤ μ•”νΈν™”

### π“Β λ€μΉ­ν‚¤ μ•”νΈν™”(symmetric-key algorithm)

> μ•”νΈν™”μ™€ λ³µνΈν™”μ— κ°™μ€ μ•”νΈν‚¤(λ€μΉ­ ν‚¤)λ¥Ό μ‚¬μ©

<br/>

### π“Β λΉ„λ€μΉ­ν‚¤(Asymmetric Key) = κ³µκ°ν‚¤(Public Key)

> μ•”νΈν™”μ™€ λ³µνΈν™”μ— μ‚¬μ©ν•λ” μ•”νΈν‚¤λ¥Ό λ¶„λ¦¬

<br/>

κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹μ—μ„ μ‚¬μ©ν•λ” λ€ν‘μ μΈ ν‚¤ κµν™ μ•κ³ λ¦¬μ¦: `RSA` μ•κ³ λ¦¬μ¦, `Diffie-Hellman` μ•κ³ λ¦¬μ¦

<br/>
<aside>
π’΅ TLS ν•Έλ“μ…°μ΄ν¬μ μ •ν™•ν• λ‹¨κ³„λ” μ‚¬μ©λλ” ν‚¤ κµν™ μ•κ³ λ¦¬μ¦μ μ ν•κ³Ό μ»¤λ®¤λ‹μΌ€μ΄μ… μ–‘μΈ΅μ—μ„ λ¨λ‘ μ§€μ›ν•λ” μ•”νΈ μ ν’κµ°μ μ ν•μ— λ”°λΌ λ‹¬λΌμ§€λ‚, λ€λ¶€λ¶„ RSA ν‚¤ κµν™ μ•κ³ λ¦¬μ¦μ΄ μ‚¬μ©λλ‹¤.
</aside>

λ¨λ“  TLS ν•Έλ“μ…°μ΄ν¬κ°€ λΉ„λ€μΉ­ μ•”νΈν™”(κ³µκ° ν‚¤μ™€ κ°μΈ ν‚¤)λ¥Ό μ‚¬μ©ν•μ§€λ§,μ„Έμ… ν‚¤λ¥Ό μƒμ„±ν•λ” κ³Όμ •μ—μ„ λ¨λ‘κ°€ κ°μΈ ν‚¤λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ€ μ•„λ‹λ‹¤.(ex. Diffie-Hellman)

<br/>

## 3. μ©μ–΄ μ •λ¦¬ π‘‰Β CAμ™€ SSL μΈμ¦μ„

<br/>

### π“Β SSL μΈμ¦μ„

> SSLμ„ μ‹¤ν–‰μ‹ν‚¬ μ μλ” μΈμ¦μ„

<br/>

SSLμ€ SSL μΈμ¦μ„(κ³µμ‹μ μΌλ΅ "TLS μΈμ¦μ„")κ°€ μλ” μ›Ήμ‚¬μ΄νΈλ§ μ‹¤ν–‰ν•  μ μλ‹¤.

SSL μΈμ¦μ„λ” μ›Ήμ‚¬μ΄νΈλ‚ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„κ°€ μ›Ήμ— μ €μ¥ν•κ³  ν‘μ‹ν•λ‹¤.

<br/>

### π“Β CA(Certificate Authority)

> μΈμ¦ κΈ°κ΄€μ€ λ‹¤λ¥Έ κ³³μ—μ„ μ‚¬μ©ν•κΈ° μ„ν• λ””μ§€ν„Έ μΈμ¦μ„λ¥Ό λ°κΈ‰ν•λ” ν•λ‚μ λ‹¨μ„

<br/>

CA(μΈμ¦ κΈ°κ΄€)λ” SSL μΈμ¦μ„ λ°ν–‰μ„ λ‹΄λ‹Ήν•λ‹¤.

<br/>

# B. TLS & SSL Handshakeμ λ‹¨κ³„

### λ°μƒ μ‹κΈ°

μ‚¬μ©μκ°€ HTTPSλ¥Ό ν†µν•΄ μ›Ή μ‚¬μ΄νΈλ¥Ό νƒμƒ‰ν•κ³  **λΈλΌμ°μ €κ°€ μ²μ ν•΄λ‹Ή μ›Ή μ‚¬μ΄νΈμΒ μ›λ³Έ μ„λ²„
λ¥Ό μΏΌλ¦¬ν•κΈ° μ‹μ‘**ν•  λ•λ§λ‹¤ λ°μƒ.

TLS ν•Έλ“μ…°μ΄ν¬λ”Β TCP μ—°κ²°μ΄ TCP ν•Έλ“μ…°μ΄ν¬λ¥Ό ν†µν•΄ μ—΄λ¦° ν›„μ— λ°μƒν•λ‹¤.

<br/>

### λ°μƒ λ‹¨κ³„

![](https://cf-assets.www.cloudflare.com/slt3lc6tev37/5aYOr5erfyNBq20X5djTco/3c859532c91f25d961b2884bf521c1eb/tls-ssl-handshake.png)

<br/>

1. ClientHello
   - ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ—°κ²°μ„ μ‹λ„ν•λ©° μ „μ†΅ν•λ” ν¨ν‚·
   - ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ›ν•λ” TLS λ²„μ „, μ§€μ›λλ” μ•”νΈ μ ν’κµ°, κ·Έλ¦¬κ³  "ν΄λΌμ΄μ–ΈνΈ λ¬΄μ‘μ„"λΌκ³  ν•λ” λ¬΄μ‘μ„ λ°”μ΄νΈ λ¬Έμμ—΄μ΄ ν¬ν•¨λλ‹¤.

<br/>

2. ServerHello
   - ClientHello λ©”μ„Έμ§€μ— λ€ν• μ‘λ‹µ
   - μ„λ²„κ°€ μ„λ²„μ SSL μΈμ¦μ„, μ„λ²„μ—μ„ μ„ νƒν• μ•”νΈ μ ν’κµ°, κ·Έλ¦¬κ³  μ„λ²„μ—μ„ μƒμ„±ν• λ λ‹¤λ¥Έ λ¬΄μ‘μ„ λ°”μ΄νΈ λ¬Έμμ—΄μΈ "μ„λ²„ λ¬΄μ‘μ„"λ¥Ό ν¬ν•¨ν•λ” λ©”μ‹μ§€λ¥Ό μ „μ†΅

<br/>

3. Certificate
   - μ„λ²„κ°€ μμ‹ μ SSL μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬. μΈμ¦μ„ λ‚΄λ¶€μ—λ” μ„λ²„κ°€ λ°ν–‰ν• κ³µκ° ν‚¤ (κ°μΈ ν‚¤λ” λ”°λ΅ μ„λ²„κ°€ μ†μ )κ°€ λ“¤μ–΄μλ‹¤.
   - ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ SSL μΈμ¦μ„λ¥Ό μΈμ¦μ„ λ°ν–‰ κΈ°κ΄€(CA)μ„ ν†µν•΄ κ²€μ¦

<br/>

4. Server Key Exchange / ServerHello Done
   - μ„λ²„μ κ³µκ° ν‚¤κ°€ SSL μΈμ¦μ„ λ‚΄λ¶€μ— μ—†λ” κ²½μ°, μ„λ²„κ°€ μ§μ ‘ μ „λ‹¬
   - κ³µκ°ν‚¤κ°€ SSL μΈμ¦μ„ λ‚΄λ¶€μ— μλ” κ²½μ° `Server Key Exchange` λ” μƒλµλ¨

<br/>

5. ClientKeyExchange
   - ν΄λΌμ΄μ–ΈνΈλ” **λ°μ΄ν„° μ•”νΈν™”μ— μ‚¬μ©ν•  λ€μΉ­ ν‚¤λ¥Ό μƒμ„±**ν• ν›„ SSL μΈμ¦μ„ λ‚΄λ¶€μ—μ„ μ¶”μ¶ν• μ„λ²„μ κ³µκ° ν‚¤λ¥Ό μ΄μ©ν•΄ μ•”νΈν™”ν• ν›„ μ„λ²„μ—κ² μ „λ‹¬
   - μ—¬κΈ°μ„ μ „λ‹¬λ λ€μΉ­ν‚¤κ°€ TSL Handshakeμ λ°μ΄ν„°λ¥Ό μ‹¤μ λ΅ μ•”νΈν™”ν•  λ€μΉ­ν‚¤

<br/>

6. ChangeCipherSpec/Finished
   - ChangeCipherSpec ν¨ν‚·μ€ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘κ°€ μ„λ΅μ—κ² λ³΄λ‚΄λ” ν¨ν‚·μΌλ΅, κµν™ν•  μ •λ³΄λ¥Ό λ¨λ‘ κµν™ν• λ’¤ ν†µμ‹ ν•  μ¤€λΉ„κ°€ λ‹¤ λμ—μμ„ μ•λ¦¬λ” ν¨ν‚·
   - Finished ν¨ν‚·μ„ λ³΄λ‚΄μ–΄ SSL Handshakeλ¥Ό μΆ…λ£

<br/>

### λ°μƒ λ‹¨κ³„ μ •λ¦¬

<br/>

- μ„λ²„λ” CAμ— μ‚¬μ΄νΈ μ •λ³΄μ™€ κ³µκ° ν‚¤λ¥Ό μ „λ‹¬ν•μ—¬ μΈμ¦μ„λ¥Ό λ°›μ
- ν΄λΌμ΄μ–ΈνΈλ” λΈλΌμ°μ €μ— CA κ³µκ° ν‚¤κ°€ λ‚΄μ¥λμ–΄ μλ‹¤κ³  κ°€μ •
- ClientHello(μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ‚μ—΄ λ° μ „λ‹¬)
- ServerHello(μ•”νΈν™” μ•κ³ λ¦¬μ¦ μ„ νƒ)
- Server Certificate(μΈμ¦μ„ μ „λ‹¬)
- Client Key Exchange(λ°μ΄ν„°λ¥Ό μ•”νΈν™” ν•  λ€μΉ­ ν‚¤ μ „λ‹¬)
- Client / ServerHello done (μ •λ³΄ μ „λ‹¬ μ™„λ£)
- Finished(SSL Handshake μΆ…λ£)

<br/>

# C. μ°Έκ³ μλ£

π”— [TLS & SSL Handshake](https://steady-coding.tistory.com/512)

π”— [TLS ν•Έλ“μ…°μ΄ν¬λ€ λ¬΄μ—‡μΌκΉμ”?](https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/)
